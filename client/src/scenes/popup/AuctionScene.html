<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Auction Scene (CDN JS Demo)</title>
    <style>
      /* ìµœì†Œ ìŠ¤íƒ€ì¼ - Tailwindë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì„ ìœ„í•´ ê°„ë‹¨í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤. */
      body {
        background: #0f1724;
        color: #e6eef8;
        font-family: Inter, system-ui, -apple-system, Roboto, "Helvetica Neue",
          Arial;
        margin: 0;
        padding: 20px;
      }
      .container {
        max-width: 1100px;
        margin: 0 auto;
      }
      .card {
        background: #1a1d2e;
        border-radius: 12px;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 16px;
      }
      .left {
        display: flex;
        align-items: center;
        gap: 12px;
      }
      .title {
        font-size: 18px;
        font-weight: 600;
      }
      .tabs {
        display: flex;
        gap: 8px;
      }
      .btn {
        padding: 8px 14px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        color: #e6eef8;
        cursor: pointer;
        font-size: 14px;
        height: 40px;
      }
      .btn.active {
        background: linear-gradient(90deg, #a855f7, #7c3aed);
        box-shadow: 0 0 24px rgba(168, 85, 247, 0.2);
      }
      .btn.filter {
        padding: 6px 12px;
        font-size: 13px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .btn.filter.active {
        background: #4ea8de;
        box-shadow: none;
      }
      .search {
        position: relative;
      }
      .search input {
        padding: 10px 12px 10px 36px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.03);
        color: inherit;
        border: 1px solid rgba(255, 255, 255, 0.06);
        height: 40px; /* match filter/button height */
        box-sizing: border-box;
      }
      .search .icon {
        position: absolute;
        left: 10px;
        top: 50%;
        transform: translateY(-50%);
      }
      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }
      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #9aa3b2;
      }
      .item-card {
        background: #252838;
        border-radius: 12px;
        padding: 16px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        margin-bottom: 12px;
        transition: all 0.2s;
      }
      .item-card:hover {
        border-color: rgba(255, 215, 0, 0.3);
        box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
      }
      .item-content {
        display: grid;
        grid-template-columns: 1fr 90px 150px 120px;
        gap: 16px;
        align-items: center;
      }
      .item-name {
        font-size: 16px;
        font-weight: 500;
        margin-bottom: 6px;
      }
      .item-type {
        font-size: 12px;
        color: #9aa3b2;
      }
      .stat-badge {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        margin-right: 6px;
      }
      .stat-badge.hp {
        background: rgba(255, 107, 107, 0.15);
        border: 1px solid rgba(255, 107, 107, 0.3);
        color: #ff6b6b;
      }
      .stat-badge.def {
        background: rgba(78, 168, 222, 0.15);
        border: 1px solid rgba(78, 168, 222, 0.3);
        color: #4ea8de;
      }
      .stat-badge.atk {
        background: rgba(168, 85, 247, 0.15);
        border: 1px solid rgba(168, 85, 247, 0.3);
        color: #a855f7;
      }
      .seller-info {
        font-size: 13px;
        color: #9aa3b2;
        line-height: 1.8;
      }
      .price {
        text-align: right;
      }
      .price-label {
        font-size: 12px;
        color: #9aa3b2;
        margin-bottom: 4px;
      }
      .price-value {
        font-size: 22px;
        color: #ffd700;
        font-weight: 600;
      }
      .buy-btn {
        padding: 10px 20px;
        /* ê¸°ë³¸ ìƒíƒœëŠ” ì¼ë°˜ ë²„íŠ¼(.btn)ê³¼ ë™ì¼í•œ ìƒ‰ìƒ/í…Œë‘ë¦¬ë¡œ ìœ ì§€ */
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 8px;
        color: #e6eef8;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s, background 0.15s, box-shadow 0.15s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 40px;
      }
      .buy-btn:hover {
        /* í˜¸ë²„ ì‹œ ê¸°ì¡´ ê·¸ë¼ë°ì´ì…˜ + ìŠ¤ì¼€ì¼ íš¨ê³¼ ìœ ì§€ */
        background: linear-gradient(to right, #a855f7, #7c3aed);
        color: #e6eef8;
        transform: scale(1.05);
        box-shadow: 0 0 12px rgba(255, 215, 0, 0.12);
      }
      .cancel-btn {
        padding: 10px 20px;
        background: rgba(255, 107, 107, 0.15);
        border: 1px solid rgba(255, 107, 107, 0.3);
        border-radius: 8px;
        color: #ff6b6b;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }
      .cancel-btn:hover {
        background: rgba(255, 107, 107, 0.25);
      }
      .gold-display {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0);
      }
      .notyf__toast {
        padding: 0px 20px !important; /* ê¸°ë³¸ 16px â†’ ë” ì‘ê²Œ */
        border-radius: 6px !important; /* ëª¨ì„œë¦¬ ë‘¥ê·¼ ì •ë„ */
        width: auto !important; /* ìë™ ë„ˆë¹„ */
        max-width: 500px !important; /* ìµœëŒ€ ë„ˆë¹„ ëŠ˜ë¦¬ê¸° */
        max-height: 100vh !important; /* ë†’ì´ ìµœëŒ€ë¡œ */
        display: inline-block !important; /* ê°€ë¡œë¡œ ëŠ˜ì–´ë‚˜ê²Œ */
        box-shadow: none !important; /* ê·¸ë¦¼ì ì‚­ì œ */
      }
      .notyf__message {
        font-size: 15px !important; /* ê¸€ì”¨ í¬ê¸° ì¤„ì´ê¸° */
        line-height: 1.2 !important;
        display: block !important;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="root"></div>
    </div>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/notyf/notyf.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/notyf/notyf.min.js"></script>
    <!-- React & ReactDOM (UMD builds) -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel (in-browser JSX transpile for demo) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Demo: AuctionScene converted from TSX -> JS (JSX) for CDN usage -->
    <script type="text/babel">
      const { useState, useEffect } = React;
      const notyf = new Notyf({ ripple: false });

      function AuctionScene({ onNavigate }) {
        const [activeTab, setActiveTab] = useState("market");
        const [activeFilter, setActiveFilter] = useState("all");
        const [sortBy, setSortBy] = useState("recent");
        const [searchQuery, setSearchQuery] = useState("");

        const [auctionItems, setAuctionItems] = useState([]);
        const [mySales, setMySales] = useState([]);
        const [myGold, setMyGold] = useState(0);

        useEffect(() => {
          window.parent.postMessage("AUCTION_READY", "*");
          const handler = (event) => {
            if (event.data?.type === "AUCTION_DATA") {
              setMyGold(event.data.payload.myGold); // UI ì—…ë°ì´íŠ¸
              setAuctionItems(event.data.payload.auctionItems); // UI ì—…ë°ì´íŠ¸
              setMySales(event.data.payload.mySales); // UI ì—…ë°ì´íŠ¸
              window.parent.postMessage("AUCTION_RENDER_COMPLETE", "*");
            }
          };

          window.addEventListener("message", handler);
          return () => window.removeEventListener("message", handler);
        }, []);

        const getTypeLabel = (type) => {
          switch (type) {
            case "hat":
              return "ëª¨ì";
            case "top":
              return "ìƒì˜";
            case "bottom":
              return "í•˜ì˜";
            case "shoes":
              return "ì‹ ë°œ";
            case "gloves":
              return "ì¥ê°‘";
            case "weapon":
              return "ë¬´ê¸°";
            default:
              return type;
          }
        };

        // êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ì‹œ ì•„ì´í…œ ì œê±°
        const handleBuy = (auctionItem) => {
          if (myGold < auctionItem.price) {
            notyf.error("ê³¨ë“œê°€ ë¶€ì¡±í•˜ì—¬ êµ¬ë§¤í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return;
          }
          setAuctionItems((prev) =>
            prev.filter((item) => item.id !== auctionItem.id)
          );
          notyf.success("êµ¬ë§¤ ì™„ë£Œ!");
        };

        const handleCancelSale = (auctionId) => {
          setMySales((prev) => prev.filter((item) => item.id !== auctionId));
          notyf.success("íŒë§¤ ì·¨ì†Œ ì™„ë£Œ!");
        };

        //  const auctionItems = [
        //   {
        //     id: 1,
        //     itemId: 101,
        //     name: "í™”ì—¼ì˜ ê²€",
        //     type: "weapon",
        //     icon: "ğŸ”¥",
        //     atk: 65,
        //     seller: "FireMaster",
        //     price: 5000,
        //     listedAt: Date.now() - 3600000,
        //     rarity: "legendary",
        //   },
        //   {
        //     id: 2,
        //     itemId: 102,
        //     name: "ë‹¤ì´ì•„ëª¬ë“œ ê°‘ì˜·",
        //     type: "armor",
        //     icon: "ğŸ’",
        //     def: 80,
        //     seller: "DefenseKing",
        //     price: 8500,
        //     listedAt: Date.now() - 7200000,
        //     rarity: "legendary",
        //   },
        //   {
        //     id: 3,
        //     itemId: 103,
        //     name: "ë²ˆê°œ ë°˜ì§€",
        //     type: "accessory",
        //     icon: "âš¡",
        //     atk: 25,
        //     seller: "ThunderGod",
        //     price: 3200,
        //     listedAt: Date.now() - 1800000,
        //     rarity: "epic",
        //   },
        //   {
        //     id: 4,
        //     itemId: 104,
        //     name: "ì•”ì‚´ìì˜ ë‹¨ê²€",
        //     type: "weapon",
        //     icon: "ğŸ—¡ï¸",
        //     atk: 45,
        //     seller: "ShadowNinja",
        //     price: 2800,
        //     listedAt: Date.now() - 5400000,
        //     rarity: "rare",
        //   },
        //   {
        //     id: 5,
        //     itemId: 105,
        //     name: "ë§ˆë²•ì‚¬ì˜ ë¡œë¸Œ",
        //     type: "armor",
        //     icon: "ğŸ§™",
        //     def: 35,
        //     hp: 50,
        //     seller: "MagicWizard",
        //     price: 4200,
        //     listedAt: Date.now() - 10800000,
        //     rarity: "epic",
        //   },
        // ];

        //  const mySales = [
        //   {
        //     id: 201,
        //     itemId: 201,
        //     name: "ê°•ì²  ë°©íŒ¨",
        //     type: "armor",
        //     icon: "ğŸ›¡ï¸",
        //     def: 40,
        //     seller: "CurrentPlayer",
        //     price: 3500,
        //     listedAt: Date.now() - 14400000,
        //     rarity: "rare",
        //   },
        // ];

        const getTimeSince = (timestamp) => {
          const seconds = Math.floor((Date.now() - timestamp) / 1000);
          if (seconds < 3600) return `${Math.floor(seconds / 60)}ë¶„ ì „`;
          if (seconds < 86400) return `${Math.floor(seconds / 3600)}ì‹œê°„ ì „`;
          return `${Math.floor(seconds / 86400)}ì¼ ì „`;
        };

        const filterAndSortItems = () => {
          let items = auctionItems;

          // Filter by type
          if (activeFilter !== "all") {
            items = items.filter((i) => i.type === activeFilter);
          }

          // Filter by search
          if (searchQuery) {
            items = items.filter((i) =>
              i.name.toLowerCase().includes(searchQuery.toLowerCase())
            );
          }

          // Sort
          if (sortBy === "price") {
            items = [...items].sort((a, b) => a.price - b.price);
          } else {
            items = [...items].sort((a, b) => b.listedAt - a.listedAt);
          }

          return items;
        };

        const filteredItems = filterAndSortItems();

        return (
          <div className="card">
            <div className="header">
              <div className="left">
                <img
                  src="/assets/icons/auction_icon.png"
                  alt="ê±°ë˜ì†Œ ì•„ì´ì½˜"
                  style={{
                    width: 18,
                    height: 18,
                  }}
                />
                <div className="title">ê±°ë˜ì†Œ</div>
              </div>
              <div style={{ display: "flex", gap: 12, alignItems: "center" }}>
                <div className="gold-display">
                  <img
                    src="/assets/icons/coins.png"
                    width="16"
                    height="16"
                    style={{ verticalAlign: "middle" }}
                  />
                  <span style={{ color: "#ffd700", fontSize: "14px" }}>
                    ë³´ìœ  ê³¨ë“œ: {myGold}G
                  </span>
                </div>
                <button
                  className="btn"
                  onClick={() => {
                    const iframe =
                      window.parent.document.getElementById("react-ui");
                    iframe.src = "about:blank"; // ì™„ì „ ì´ˆê¸°í™”
                    iframe.style.visibility = "hidden";
                  }}
                >
                  ë‹«ê¸°
                </button>
              </div>
            </div>

            {/* Tabs and Controls - single row */}
            <div
              style={{
                display: "flex",
                justifyContent: "space-between",
                alignItems: "center",
                marginBottom: 16,
              }}
            >
              <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
                <button
                  className={"btn " + (activeTab === "market" ? "active" : "")}
                  onClick={() => setActiveTab("market")}
                >
                  ê²½ë§¤ì¥
                </button>
                <button
                  className={
                    "btn " + (activeTab === "my-sales" ? "active" : "")
                  }
                  onClick={() => setActiveTab("my-sales")}
                >
                  ë‚´ íŒë§¤ ëª©ë¡
                </button>
              </div>

              {activeTab === "market" && (
                <div style={{ display: "flex", gap: 8, alignItems: "center" }}>
                  <div
                    style={{ display: "flex", gap: 8, alignItems: "center" }}
                  >
                    <button
                      className={
                        "btn filter " + (activeFilter === "all" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("all")}
                    >
                      ì „ì²´
                    </button>
                    <button
                      className={
                        "btn filter " + (activeFilter === "hat" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("hat")}
                    >
                      ëª¨ì
                    </button>
                    <button
                      className={
                        "btn filter " + (activeFilter === "top" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("top")}
                    >
                      ìƒì˜
                    </button>
                    <button
                      className={
                        "btn filter " +
                        (activeFilter === "bottom" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("bottom")}
                    >
                      í•˜ì˜
                    </button>
                    <button
                      className={
                        "btn filter " +
                        (activeFilter === "shoe" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("shoe")}
                    >
                      ì‹ ë°œ
                    </button>
                    <button
                      className={
                        "btn filter " +
                        (activeFilter === "glove" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("glove")}
                    >
                      ì¥ê°‘
                    </button>
                    <button
                      className={
                        "btn filter " +
                        (activeFilter === "weapon" ? "active" : "")
                      }
                      onClick={() => setActiveFilter("weapon")}
                    >
                      ë¬´ê¸°
                    </button>
                  </div>
                  <div className="search">
                    <span className="icon">ğŸ”</span>
                    <input
                      placeholder="ì•„ì´í…œ ê²€ìƒ‰..."
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                    />
                  </div>
                </div>
              )}
            </div>

            {activeTab === "market" && (
              <>
                {/* Items List */}
                <div>
                  {filteredItems.map((item) => (
                    <div key={item.id} className="item-card">
                      <div className="item-content">
                        <div>
                          <div className="item-name">
                            <span style={{ marginRight: 10 }}>{item.name}</span>
                            {item.hp && (
                              <span className="stat-badge hp">
                                +{item.hp} HP
                              </span>
                            )}
                            {item.atk && (
                              <span className="stat-badge atk">
                                +{item.atk} ATK
                              </span>
                            )}
                            {item.def && (
                              <span className="stat-badge def">
                                +{item.def} DEF
                              </span>
                            )}
                          </div>
                          <div>
                            <span className="item-type">
                              {getTypeLabel(item.type)}
                            </span>
                          </div>
                        </div>

                        <div className="seller-info">
                          <div>íŒë§¤ì: {item.seller}</div>
                          <div>
                            <img
                              src="/assets/icons/flatclock.png"
                              alt="clock"
                              width="11"
                              height="11"
                              style={{
                                verticalAlign: "middle",
                                marginRight: 7,
                              }}
                            />
                            <span style={{ verticalAlign: "middle" }}>
                              {getTimeSince(new Date(item.time).getTime())}
                            </span>
                          </div>
                        </div>

                        <div className="price">
                          <div className="price-label">íŒë§¤ê°€</div>
                          <div className="price-value">
                            {item.price.toLocaleString()}G
                          </div>
                        </div>

                        <div style={{ textAlign: "right" }}>
                          <button
                            className="buy-btn"
                            onClick={() => handleBuy(item)}
                          >
                            êµ¬ë§¤
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              </>
            )}

            {activeTab === "my-sales" && (
              <>
                <div
                  style={{
                    display: "flex",
                    alignItems: "center",
                    gap: 8,
                    marginBottom: 16,
                    color: "#9aa3b2",
                  }}
                ></div>

                <div>
                  {mySales.length > 0 ? (
                    mySales.map((item) => (
                      <div key={item.id} className="item-card">
                        <div className="item-content">
                          <div>
                            <div className="item-name">
                              <span style={{ marginRight: 10 }}>
                                {item.name}
                              </span>
                              {item.hp && (
                                <span className="stat-badge hp">
                                  +{item.hp} HP
                                </span>
                              )}
                              {item.atk && (
                                <span className="stat-badge atk">
                                  +{item.atk} ATK
                                </span>
                              )}
                              {item.def && (
                                <span className="stat-badge def">
                                  +{item.def} DEF
                                </span>
                              )}
                            </div>
                            <div>
                              <span className="item-type">
                                {getTypeLabel(item.type)}
                              </span>
                            </div>
                          </div>

                          <div className="seller-info">
                            <img
                              src="/assets/icons/flatclock.png"
                              alt="clock"
                              width="11"
                              height="11"
                              style={{
                                verticalAlign: "middle",
                                marginRight: 7,
                              }}
                            />
                            <span style={{ verticalAlign: "middle" }}>
                              {getTimeSince(new Date(item.time).getTime())}
                            </span>
                          </div>

                          <div className="price">
                            <div className="price-label">íŒë§¤ê°€</div>
                            <div className="price-value">
                              {item.price.toLocaleString()}G
                            </div>
                          </div>

                          <div style={{ textAlign: "right" }}>
                            <button
                              className="cancel-btn"
                              onClick={() => handleCancelSale(item.id)}
                            >
                              íŒë§¤ ì·¨ì†Œ
                            </button>
                          </div>
                        </div>
                      </div>
                    ))
                  ) : (
                    <div className="empty-state">
                      <img
                        src="/assets/icons/inventory_hide.png"
                        alt="Gold"
                        width="23"
                        height="23"
                        style={{ verticalAlign: "middle" }}
                      />
                      {"   "}
                      <span style={{ verticalAlign: "middle" }}>
                        ë“±ë¡ëœ ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.
                      </span>
                    </div>
                  )}
                </div>
              </>
            )}
          </div>
        );
      }

      // ì˜ˆì‹œ ë Œë”ë§: rootì— ë¶™ì´ê¸°
      ReactDOM.createRoot(document.getElementById("root")).render(
        React.createElement(AuctionScene, {
          onNavigate: (scene) => {
            console.log("navigate to", scene);
          },
        })
      );
    </script>
  </body>
</html>
